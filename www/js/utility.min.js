function cartDetailsToolbarHeader(){invoice.taxFree||invoice.isTaxFreeDiscountActive()?$$(".tax-toolbar").html("No Tax"):$$(".tax-toolbar").html(formatNumberMoney(invoice.taxAmount)),$$(".taxpercent").html((100*invoice.taxPercent).toFixed(1)+"%"),$$(".delivery-toolbar").html(formatNumberMoney(invoice.delivery.cost)),0!=EMPLOYEE.invoiceLocationID&&$$(".invoicelocation-toolbar").html(getLocationNickname(EMPLOYEE.invoiceLocationID)),$$(".subtotal-toolbar").html(formatNumberMoney(invoice.subtotalAmount)),invoice.discount>0?($$(".discount-toolbar").html('<span style="color:green;">'+formatNumberMoney(invoice.discount)+"</span>"),$$(".discount-label-toolbar").show()):($$(".discount-toolbar").html(""),$$(".discount-label-toolbar").hide()),$$(".total-toolbar").html(formatNumberMoney(invoice.totalAmount+invoice.delivery.cost))}function cartDetailsSummaryScreen(){$$("#summary-subtotal").text(formatNumberMoney(invoice.subtotalAmount)),$$("#summary-tax").text(formatNumberMoney(invoice.taxAmount)),$$("#summary-delivery").text(formatNumberMoney(invoice.delivery.cost)),$$("#summary-total").text(formatNumberMoney(invoice.totalAmount+invoice.delivery.cost)),invoice.totalAmount-invoice.getRemainingBalance()==0?$$("#summary-paid-label").hide():$$("#summary-paid").text(formatNumberMoney(invoice.getRemainingBalance()))}function confirmModal(e,t){myApp.confirm(e,t)}function formatNumberMoney(e){return"$"+roundTo(e,2).toFixed(2)}function noop(){return this}function consool(e){DEBUG_MODE&&console.log(e)}function numberArrayize(e,t){var a=[]
t=e>t?t:e
for(var i=0;i<t;i++)a[i]=i+1
return a}function roundTo(e,t){void 0===t&&(t=0)
var a=Math.pow(10,t)
return e=parseFloat((e*a).toFixed(11)),+(Math.round(e)/a).toFixed(2)}function nameNotTaken(e){for(var t=0;t<INVOICES.length;t++)if(e==INVOICES[t].title)return t
return!0}function decoupleObj(e){return JSON.parse(JSON.stringify(e))}function getPagename(){return $$(".page-on-center").data("page")}function toast(e,t){window.plugins.toast.showWithOptions({message:e,duration:t,position:"bottom",addPixelsY:-20})}function createStockArray(e){var t=e.location
switch(t){case"I":return numberArrayize(e.stock[0].available,10)
case"W":return numberArrayize(e.stock[1].available,10)
case"O":return numberArrayize(e.stock[2].available,10)
case"SO":return numberArrayize(e.stock[e.stock.length-1].available,10)}}function getLocationNickname(e){switch(e){case"I":case 1:return"Store"
case"W":case 2:return"Warehouse"
case"O":case 5:return"Outlet"
case"H":case 6:return"Hospatility"
case"45th":case 7:return"45th St Bedding"
case"BMO":case 8:return"B&M Online"
case"P":case 9:return"Philanthropy"
case"SO":case 42:return"Special Order"
default:return"XX"}}function serviceActions(){var e="<-- Draft & Quotes",t="--\x3e Invoice Actions"
choicelistModal({type:"modal",title:"Services:",data:[e,"Discount Actions",t],success:function(a,i,o){switch(o[a]){case e:draftAndQUoteActions()
break
case"Discount Actions":discountActions()
break
case"Fee Actions":feeActions()
break
case t:invoiceActions()}}})}function discountActions(){choicelistModal({type:"modal",title:"Services:",data:["Add Discount","Tax Exempt","Clear Discounts","<-- Back"],success:function(e,t,a){switch(a[e]){case"Add Discount":addDiscountModal()
break
case"Tax Exempt":taxExemptModal()
break
case"Clear Discounts":invoice.setDiscounts([]),invoice.setTaxFree(!1),mainView.router.refreshPage()
break
case"<-- Back":serviceActions()}}})}function taxExemptModal(){var e=myApp.modal({title:"Enter Driver's License",text:'<input id="driver-license-number">',buttons:[{text:"Cancel",onClick:function(){}},{text:"Okay",onClick:function(){$$("#driver-license-number").val()
invoice.setTaxFree(!0),toast("Tax Exempt",SHORT)}}]})
$$(e).addClass("save-draft-modal")}function feeActions(){choicelistModal({type:"modal",title:"Services:",data:["Add Fee","Clear Fees","<-- Back"],success:function(e,t,a){switch(a[e]){case"Add Fee":addFeeModal()
break
case"Clear Fees":break
case"<-- Back":serviceActions()}}})}function invoiceActions(){var e="<-- Cart Actions",t="--\x3e Draft & Quotes"
choicelistModal({type:"modal",title:"Invoice Options:",data:[e,"Change Location","Transfer Invoice","Reset Sale",t],success:function(a,i,o){switch(o[a]){case e:serviceActions()
break
case"Change Location":locationChangeChoicelist(),cartDetailsToolbarHeader()
break
case"Transfer Invoice":TM.listStations(function(e){transferInvoiceModal(e.stations)})
break
case"Reset Sale":invoice.reinit(),mainView.router.refreshPage()
break
case t:draftAndQUoteActions()}}})}function locationChangeChoicelist(){choicelistModal({type:"modal",data:["Store","Outlet","Hospatility","45th Street Bedding","Bedrooms & More Online","Philanthropy"],success:function(e,t,a){switch(a[e]){case"Store":EMPLOYEE.invoiceLocationID=1
break
case"Outlet":EMPLOYEE.invoiceLocationID=5
break
case"Hospatility":EMPLOYEE.invoiceLocationID=6
break
case"45th Street Bedding":EMPLOYEE.invoiceLocationID=7
break
case"Bedrooms & More Online":EMPLOYEE.invoiceLocationID=8
break
case"Philanthropy":EMPLOYEE.invoiceLocationID=9}$$(".invoicelocation-toolbar").html(getLocationNickname(EMPLOYEE.invoiceLocationID))}})}function transferInvoiceModal(e){choicelistModal({type:"modal",data:e,success:function(e,t,a){invoice.invoiceLocationID=EMPLOYEE.invoiceLocationID,invoice.employee=EMPLOYEE,TM.transferInvoice(a[e],invoice,consool)}})}function draftAndQUoteActions(){var e="<-- Invoice Actions",t="--\x3e Cart Actions"
choicelistModal({type:"modal",title:"Drafts & Quotes",data:[e,"Drafts","Quotes",t],success:function(a,i,o){switch(o[a]){case e:invoiceActions()
break
case"Drafts":draftActions()
break
case"Quotes":quoteActions()
break
case t:serviceActions()}}})}function addDiscountModal(){choicelistModal({type:"modal",data:["Standard Discount","Custom Discount","Memorial Day","<-- Back"],success:function(e,t,a){switch(a[e]){case"Standard Discount":standardDiscountModal()
break
case"Custom Discount":customDiscountModal()
break
case"Memorial Day":memorialDaySale()
break
case"<-- Back":discountActions()}mainView.router.refreshPage()}})}function standardDiscountModal(){choicelistModal({type:"modal",data:["PMD","Tax Free","Toll Bridge","<-- Back"],success:function(e,t,a){switch(a[e]){case"PMD":invoice.addDiscount({type:"PMD"})
break
case"Tax Free":invoice.addDiscount({type:"Tax"})
break
case"Toll Bridge":invoice.addDiscount({type:"Toll"})
break
case"<-- Back":standardDiscountModal()}mainView.router.refreshPage()}})}function customDiscountModal(){var e=[],t="",a="",i=myApp.modal({title:"Custom Discount",text:'<div class="list-block"><ul class="custom-discount-item-select"><li class="accordion-item"><a href="#" class="item-content item-link"><div class="item-inner"><div class="item-title">Select Items</div></div></a><div class="accordion-item-content"><div class="content-block"><ul id="cart-discount-list"></ul></div></div></li></ul><div class="custom-discount-type-div"><span class="custom-discount-type" data-type="dollar">$</span><span class="custom-discount-or">OR</span><span class="custom-discount-type" data-type="percent">%</span></div><div class="custom-discount-amount-div"><input type="number" id="custom-discount-amount"></div></div>',buttons:[{text:"Cancel",onClick:function(){}},{text:"Add",onClick:function(){}}]})
$$(i).addClass("custom-discount-modal")
var o=$$(i).find(".modal-button")[1]
$$(o).attr("disabled",!0)
for(var c=0;c<invoice.salesLines.length;c++){var s='<div class="row item-select" data-id="'+c+'"><div class="col-15"><div class="custom-discount-list-item"></div></div><div class="col-85"><span class="custom-discount-list-item-label">'+invoice.salesLines[c].name+"</span></div></div>"
$$("#cart-discount-list").append(s)}$$(".item-select").on("click",function(){var i=$$(this),c=$$(this).data("id")
if(i.hasClass("active")){i.removeClass("active")
for(var s=0;s<e.length;s++)e[s]==c&&e.splice(s,1)
task(e,t,a,o)}else e.push(c),i.addClass("active"),task(e,t,a,o)}),$$(".custom-discount-type").on("click",function(){$$(".custom-discount-type").removeClass("active"),$$(this).addClass("active"),t=$$(this).data("type"),task(e,t,a,o)}),$$("#custom-discount-amount").on("keyup",function(){a=$$(this).val(),task(e,t,a,o)})}function task(e,t,a,i){e.length>0&&""!=t&&a>0&&""!=a?(consool(e),consool(t),consool(a),$$(i).attr("disabled",!1)):$$(i).attr("disabled",!0)}function draftActions(){choicelistModal({type:"modal",title:"Clear:",data:["Save Draft","Load Draft","Delete Draft","<-- Back"],success:function(e,t,a){switch(a[e]){case"Save Draft":saveDraft()
break
case"Load Draft":loadDraftChoicelist("load")
break
case"Delete Draft":loadDraftChoicelist("delete")
break
case"<-- Back":draftAndQUoteActions()}}})}function quoteActions(){choicelistModal({type:"modal",title:"Clear:",data:["Save Quote","Load Quote","Print Quote","Delete Quote","<-- Back"],success:function(e,t,a){switch(a[e]){case"Save Quote":saveQuote()
break
case"Load Quote":loadQuoteChoicelist("load")
break
case"Print Quote":loadQuoteChoicelist("print")
break
case"Delete Quote":loadQuoteChoicelist("delete")
break
case"<-- Back":draftAndQUoteActions()}}})}function saveDraft(){var e=myApp.modal({title:"Save Draft?",text:'<input id="draft-name-box">',buttons:[{text:"Cancel",onClick:function(){}},{text:"Save",onClick:function(){var e=$$("#draft-name-box").val(),t=nameNotTaken(e)
t?(invoice.setTitle(e),INVOICES.push(decoupleObj(invoice)),NativeStorage.setItem("invoices",JSON.stringify(INVOICES),noop,consool)):isNaN(t)||(consool("name taken"),consool(INVOICES[t]))}}]})
$$(e).addClass("save-draft-modal")}function saveQuote(){var e=myApp.modal({title:"Save Quote?",text:'<input id="quote-name-box">',buttons:[{text:"Cancel",onClick:function(){}},{text:"Save",onClick:function(){var e=$$("#quote-name-box").val()
invoice.setTitle(e),invoice.setPayments([]),TM.saveQuote(invoice,function(e){})}}]})
$$(e).addClass("save-quote-modal")}function loadDraftChoicelist(e){for(var t=[],a=0;a<INVOICES.length;a++)t.push(INVOICES[a].title)
choicelistModal({type:"modal",data:t,success:function(t,a,i){switch(e){case"load":invoice=new Invoice(decoupleObj(INVOICES[t])),invoice.recalc(),mainView.router.refreshPage()
break
case"delete":t>-1&&INVOICES.splice(t,1)}}})}function loadQuoteChoicelist(e){TM.getQuoteList(function(t){for(var a=t.quotes,i=[],o=0;o<a.length;o++)i.push(a[o].name)
choicelistModal({type:"modal",data:i,success:function(t,i,o){switch(e){case"load":TM.getQuote(a[t].id,function(e){invoice=new Invoice(e.quote),mainView.router.refreshPage()})
break
case"print":var c=a[t]
TM.listPrinters(function(e){for(var t=[],a=[],i=0;i<e.altnames.length;i++)t.push(e.altnames[i]),a.push(e.names[i])
choicelistModal({type:"modal",data:t,success:function(e,t,i){consool(c.id),consool(a[e]),TM.printInvoice(c.id,"quote",a[e],consool)}})})
break
case"delete":TM.deleteQuote(a[t].id,function(e){consool(e)})}}})})}function memorialDaySale(){choicelistModal({type:"modal",data:["2-Sided Classics Credit","Botanicore Bedding Bundle","45th Adjustable Base Credit","Bedding Bundle","In-Stock Lighting","In-Stock Seating"],success:function(e,t,a){switch(a[e]){case"2-Sided Classics Credit":invoice.addDiscount({type:"2SideCred"})
break
case"Botanicore Bedding Bundle":invoice.addDiscount({type:"botanBedBund"})
break
case"45th Adjustable Base Credit":invoice.addDiscount({type:"45AdjBaseCred"})
break
case"Bedding Bundle":invoice.addDiscount({type:"beddingBund"})
break
case"In-Stock Lighting":invoice.addDiscount({type:"instockLighting"})
break
case"In-Stock Seating":invoice.addDiscount({type:"instockSeating"})}mainView.router.refreshPage()}})}var loginPopup=function(e){myApp.popup('<div class="popup login-popup"><div class="login-popup-content"><p class="center-align"><img src="media/symbol.png" class="login-symbol"></p><h2 class="center-align white">Employee Portal</h2><div class="bottom-center"><div><p class="center-align"><input type="number" id="password" placeholder="Password" class="password-login" pattern="[0-9]*" inputmode="numeric"></p><p class="center-align"><button class="login-button">Login</button></p><p class="center-align"> Forgot Password?</p><p class="center-align"> Contact Matt to reset.</p></div></div></div></div>')},login=function(e){myApp.showIndicator(),TM.login(e,function(e){notificationTimeoutStart(0,0,0,0),EMPLOYEE.id=e.id,EMPLOYEE.name=e.name,EMPLOYEE.department=e.department,EMPLOYEE.locationid=e.store,EMPLOYEE.invoiceLocationID=e.invoiceLocationID,invoice.setSalesperson(EMPLOYEE.name),myApp.hideIndicator(),$$(".login-popup").length>0?(myApp.closeModal(".login-popup"),toast("Logged In - "+EMPLOYEE.name,SHORT)):mainView.router.loadPage({url:"profile.html"})},function(e){myApp.hideIndicator(),$$(".login-popup").length>0?toast("Invalid Login - Popup",SHORT):toast("Invalid Login",SHORT)})},logout=function(){},choicelistModal=function(e){var t={data:[],title:"Please Choose:",success:function(){},error:function(){},closeModal:!0,searchbar:!1,searchbarDataUrl:"",closeModal:!0,type:"modal"}
if($$.each(e,function(e,a){t[e]=a}),t.data.length>0){switch(t.type){case"modal":var a=1==t.closeModal?" close-modal":"",i=""
switch(t.searchbar&&(i+='<form class="searchbar"><div class="searchbar-input"><input type="search" placeholder="Search"><a href="#" class="searchbar-clear"></a></div><a href="#" class="searchbar-cancel">Cancel</a></form>'),i+='<div class="scrollableContainer modalScrollable"><div class="list-block list-blockModal searchbar-found" style="margin: 0px;"><ul>',typeOfData=Object.prototype.toString.call(t.data[0]),typeOfData){case"[object String]":case"[object Number]":for(var o=0;o<t.data.length;o++)i+='<li><a href="#" data-index="'+o+'" data-id="'+o+'" class="item-link choicelistselect'+a+'"><div class="item-content"><div class="item-inner"><div class="item-title">'+t.data[o]+"</div></div></div></a></li>"
break
case"[object Object]":for(var o=0;o<t.data.length;o++)i+='<li><a href="#" data-index="'+o+'" data-id="'+t.data[o].id+'" class="item-link choicelistselect'+a+'"><div class="item-content"><div class="item-inner"><div class="item-title">'+t.data[o].text+"</div></div></div></a></li>"}i+="</ul></div></div>",myApp.modal({title:t.title,text:i,buttons:[{text:"Cancel"}]}),$$(".modal-overlay.modal-overlay-visible").on("click",function(){myApp.closeModal(".modal")}),$$(".modal-in .modal-inner").css("padding-right","0px").css("padding-bottom","0px").css("padding-left","0px"),$$(".modal-in .modal-title").css("width","100%").css("text-align","center"),$$(".modal-in .modal-text").css("width","100%")
break
case"picker":var c=1==t.closeModal?" close-picker":"",s='<div class="picker-modal"><div class="toolbar"><div class="toolbar-inner"><div class="left">'+t.title+'</div><div class="right"><a href="#" class="close-picker">Close</a></div></div></div><div class="picker-modal-inner"><div class="scrollableContainer modalScrollable"><div class="list-block" style="margin: 0px;"><ul>'
switch(typeOfData=Object.prototype.toString.call(t.data[0]),typeOfData){case"[object String]":case"[object Number]":for(var o=0;o<t.data.length;o++)s+='<li><a href="#" data-index="'+o+'" data-id="'+o+'" class="item-link choicelistselect'+c+'"><div class="item-content"><div class="item-inner"><div class="item-title">'+t.data[o]+"</div></div></div></a></li>"
break
case"[object Object]":for(var o=0;o<t.data.length;o++)s+='<li><a href="#" data-index="'+o+'" data-id="'+t.data[o].id+'" class="item-link choicelistselect'+c+'"><div class="item-content"><div class="item-inner"><div class="item-title">'+t.data[o].text+"</div></div></div></a></li>"}s+="</ul></div></div></div>",$$(".picker-modal.modal-in").length>0&&myApp.closeModal(".picker-modal.modal-in"),myApp.pickerModal(s)
break
case"popup":default:var n=1==t.closeModal?" close-popup":"",l='<div class="popup choicelistPopup"><a href="#" class="popupClose close-popup"><i class="f7-icons">close_round</i></a><div class="content-block"><div class="content-block-inner">'+t.title+'</div></div><div class="list-block"><ul>'
switch(typeOfData=Object.prototype.toString.call(t.data[0]),typeOfData){case"[object String]":case"[object Number]":for(var o=0;o<t.data.length;o++)l+='<li><a href="#" data-index="'+o+'" data-id="'+o+'" class="item-link choicelistselect'+n+'"><div class="item-content"><div class="item-inner"><div class="item-title">'+t.data[o]+"</div></div></div></a></li>"
break
case"[object Object]":for(var o=0;o<t.data.length;o++)l+='<li><a href="#" data-index="'+o+'" data-id="'+t.data[o].id+'" class="item-link choicelistselect'+n+'"><div class="item-content"><div class="item-inner"><div class="item-title">'+t.data[o].text+"</div></div></div></a></li>"}l+="</ul></div></div>",myApp.popup(l)}if(t.searchbar){MyApp.searchbar(".searchbar",{searchList:".list-blockModal",searchIn:".item-title"})
$$(".searchbar-input input").focus()}$$(".choicelistselect").click(function(){if(t.closeModal)switch(t.type){case"modal":myApp.closeModal(".modal")}var e=$$(this)
t.success(parseInt(e.attr("data-index")),e.find(".item-title").text(),t.data,parseInt(e.attr("data-id")))})}}
