/*
* Application Name: MyBnMApp
* Version: 1.2 alpha
* Application URI: Google Play Address
* Description: An application that serves as an employee portal and tool
* Authors: Jordan Little and Matt Davis
*
* Supported:       ios(phone), android(phone)
* Not Supported:   Windows Phone, Web
*
*/
var myApp=new Framework7({}),$$=Dom7,isAndroid=!0===Framework7.prototype.device.android,isIos=!0===Framework7.prototype.device.ios,isBrowser=!!(!isAndroid&!isIos),TM=new TaskMaster,invoice=new Invoice,DEBUG_MODE=!0,SHORT="short",LONG="long",INVOICES=[],EMPLOYEE={id:0,name:"",department:"",locationid:0,invoiceLocationID:0},userSwitch=0
switch(userSwitch){case 1:EMPLOYEE.id=42,EMPLOYEE.name="JordanL",EMPLOYEE.department="IT",EMPLOYEE.locationid=5,EMPLOYEE.invoiceLocationID=8
break
case 2:EMPLOYEE.id=16,EMPLOYEE.name="MattD",EMPLOYEE.department="IT",EMPLOYEE.locationid=5,EMPLOYEE.invoiceLocationID=8}var mainView=myApp.addView(".view-main",{dynamicNavbar:!0,pushState:!0})
$$(document).on("deviceready",function(){function e(){$$(".img-lightbox").remove()}invoice.load()
var i={model:device.model,platform:device.platform,version:device.version,manufacturer:device.manufacturer,resolution:{height:window.innerHeight,width:window.innerWidth}}
$$(".framework7-root").on("click",".send-feedback",function(){var e=myApp.getCurrentView().activePage.name,t='<div class="popup feedback-popup center-align" id="feedback-pop"><div class="popup-header"><h1>Feedback</h1><i id="feedback-close" class="icon f7-icons">close</i></div><div class="content-block center-align"><p>Thank you for submitting your feedback. All Feedback will be reviewed by Matt and Jordan</p><div class="left-align">Page:'+e+'</div><textarea class="feedback-input"></textarea><div id="submit-feedback">Submit</div></div></div>'
myApp.popup(t),$$("#submit-feedback").on("click",function(){var t=$$(".feedback-input").val()
t.length>0?TM.sendFeedback(e,t,i,function(){myApp.closeModal("#feedback-pop"),toast("Feedback Submitted",SHORT)}):toast("No Feedback",SHORT)}),$$("#feedback-close").on("click",function(){myApp.closeModal("#feedback-pop")})}),$$(".framework7-root").on("click",".settings",function(){for(var e=["Print","Settings","Update","Logout"],i=["print-setting-menu","settinglink-setting-menu","update-setting-menu","logout-setting-menu"],t="",o=0;o<e.length;o++)t+='<li class="item-content" id="'+i[o]+'"><div class="item-inner"><div class="item-title">'+e[o]+"</div></div></li>"
var n=this,a='<div class="popover setting-popover"><div class="popover-inner"><div class="list-block">'+t+"</div></div></div>"
myApp.popover(a,n),$$("#print-setting-menu").on("click",function(){consool(this)}),$$("#settinglink-setting-menu").on("click",function(){mainView.router.loadPage("settings.html"),myApp.closeModal(".setting-popover")}),$$("#update-setting-menu").on("click",function(){consool(this)}),$$("#logout-setting-menu").on("click",function(){logout()})}),$$(".framework7-root").on("click",".home-icon",function(){mainView.router.back({url:"profile.html",force:!0})}),$$(".framework7-root").on("click",".message-list-icon",function(){mainView.router.loadPage("msg_list.html")}),$$(".framework7-root").on("click",".pos-actions",function(){serviceActions()}),$$(".framework7-root").on("click",".quantity-col-card",function(){var e=$$(this),i=e.data("id"),t=createStockArray(invoice.salesLines[i])
choicelistModal({type:"modal",data:t,success:function(t,o,n){invoice.changeQuantity(i,n[t])
var a=e.parent().parent().parent().parent()[0].className,c=e.parent().parent().parent().parent()[0].id
""!=c?invoice.draw("#"+c):"cart-list"==a&&invoice.draw("."+a),cartDetailsToolbarHeader()}})}),$$(".framework7-root").on("click",".location-edit-card",function(){var e=$$(this),i=e.data("id")
choicelistModal({type:"modal",data:["Store","Warehouse","Outlet","Special Order"],success:function(t,o,n){switch(n[t]){case"Store":invoice.changeLocation(i,"I")
break
case"Warehouse":invoice.changeLocation(i,"W")
break
case"Outlet":invoice.changeLocation(i,"O")
break
case"Special Order":invoice.changeLocation(i,"SO")}var a=e.parent().parent().parent().parent().parent().parent()[0].className,c=e.parent().parent().parent().parent().parent().parent()[0].id
""!=c?invoice.draw("#"+c):"cart-list"==a&&invoice.draw("."+a),cartDetailsToolbarHeader()}})}),$$(".framework7-root").on("click",".delete-line",function(){var e=$$(this),i=e.parent().parent().parent()[0].className,t=e.parent().parent().parent()[0].id
confirmModal("Delete this item?",function(){invoice.deleteLine(e.data("id")),""!=t?invoice.draw("#"+t):"cart-list"==i&&invoice.draw("."+i),cartDetailsToolbarHeader(),cartDetailsSummaryScreen()})}),$$(".framework7-root").on("click",".minimize-line",function(){var e=$$(this)
invoice.salesLines[e.data("id")].minimized=!0
var i=e.parent().parent().find(".card-content")
e.removeClass("minimize-line"),e.addClass("restore-line"),e.empty().append('<i class="icon f7-icons">up</i>'),i.hide()}),$$(".framework7-root").on("click",".restore-line",function(){var e=$$(this)
invoice.salesLines[e.data("id")].minimized=!1
var i=e.parent().parent().find(".card-content")
e.removeClass("restore-line"),e.addClass("minimize-line"),e.empty().append('<i class="icon f7-icons">down</i>'),i.show()})
var t
$$(".framework7-root").on("keyup","#search-box",function(){this.value.length>3&&(clearTimeout(t),function(e){t=setTimeout(function(){TM.searchInventory(e,function(e){$$(".search-results").empty()
for(var i=e.inventoryNames,t=e.inventorySkus,o=0;o<i.length;o++){var n=$$('<li class="item-content" data-sku="'+t[o]+'"><div class="item-inner"><div class="item-title search-result-item">'+i[o]+"</div></div></li>")
n.on("click",function(){TM.getItemInfo($$(this).data("sku"),invoice.itemPopup)}),$$(".search-results").append(n)}})},500)}(this.value))}),$$("#clear-native").on("click",function(){NativeStorage.clear(consool,consool)}),NativeStorage.getItem("sameBilling",noop,function(e){2==e.code&&NativeStorage.setItem("sameBilling",!1,noop,noop)}),NativeStorage.getItem("method",noop,function(e){2==e.code&&invoice.setDeliveryMethod("team")}),NativeStorage.getItem("location",noop,function(e){2==e.code&&(invoice.delivery.location="I")}),NativeStorage.getItem("invoices",function(e){e=JSON.parse(e)
for(var i=0;i<e.length;i++)INVOICES.push(new Invoice(e[i]))},function(e){2==e.code?INVOICES=[]:consool(e)}),0!=EMPLOYEE.id?mainView.router.loadPage({url:"profile.html"}):navigator.splashscreen.hide(),$$("#password").on("focus",function(){$$(this).val("")}),$$(".framework7-root").on("click",".login-button",function(){login($$("#password").val())}),$$(".framework7-root").on("click",".lightbox-image",function(){e(),$$(".framework7-root").off("click","body",e),$$(".framework7-root").on("click","body",e),$$("body").append('<div style="top:150px;" class="img-lightbox"><div class="img-lightbox-inner"><img class="lightbox-img" src="'+$$(this).prop("src")+'"></div></div>')})}),myApp.onPageInit("profile",function(e){$$(".admin-setting-link").on("click",function(){}),$$(".employee-name").text(EMPLOYEE.name),$$(".employee-department").text(EMPLOYEE.department),$$(".email-popup").on("click",function(){window.open("message://","_system")}),$$(".phone-dial").on("click",function(){window.open("tel://","_system")})
myApp.swiper(".profile-swiper",{})
$$(".scan-catch").on("click",function(){cloudSky.zBar.scan({text_title:"Bedrooms and More",text_instructions:"Scan Product QR Code",camera:"back",flash:"off",drawSight:!0},function(e){var i=e.search("qr/"),t=e.substr(i+3)
choicelistModal({type:"modal",data:["Add to Cart","Other Option"],success:function(e,i,o){switch(o[e]){case"Add to Cart":mainView.router.loadPage("pos_cart.html"),TM.getItemInfo(t,invoice.itemPopup)}}})})}),navigator.splashscreen.hide()}),myApp.onPageInit("pos_cart pos_customer pos_delivery pos_summary",function(e){PoSNavigationInit(e),PoSContinueInit(e),cartDetailsToolbarHeader()}),myApp.onPageInit("pos_cart",function(e){function i(){var e=myApp.modal({title:"Search",text:'<input id="search-box" placeholder="Search">',afterText:'<div class="list-block search-result-div"><ul class="search-results"></ul></div>',buttons:[{text:"Cancel",onClick:function(){}}]})
$$(e).addClass("search-modal"),$$("#search-box").focus()}function t(){cloudSky.zBar.scan({text_title:"Bedrooms and More",text_instructions:"Scan Product QR Code",camera:"back",flash:"off",drawSight:!0},function(e){var i=e.search("qr/"),t=e.substr(i+3)
TM.getItemInfo(t,invoice.itemPopup)})}invoice.draw(),$$("#scan-button").on("click",t),$$("#search-button").on("click",i)}),myApp.onPageInit("pos_customer",function(e){$$("#firstName").val(invoice.customer.first),$$("#lastName").val(invoice.customer.last),$$("#email").val(invoice.customer.email),$$("#phoneNumber").val(invoice.customer.phoneNumber),$$("#streetOne").val(invoice.customer.billing.street),$$("#streetTwo").val(invoice.customer.billing.streetTwo),$$("#city").val(invoice.customer.billing.city),$$("#state").val(invoice.customer.billing.state),$$("#zip").val(invoice.customer.billing.zip),$$("#firstName").on("keyup",function(){invoice.setFirstName(this.value)}),$$("#lastName").on("keyup",function(){invoice.setLastName(this.value)}),$$("#email").on("keyup",function(){invoice.setEmail(this.value)}),$$("#phoneNumber").on("keyup",function(){invoice.setPhoneNumber(this.value)}),$$("#streetOne").on("keyup",function(){invoice.setBillingStreet(this.value)}),$$("#streetTwo").on("keyup",function(){invoice.setBillingStreetTwo(this.value)}),$$("#city").on("keyup",function(){invoice.setBillingCity(this.value)}),$$("#state").on("keyup",function(){invoice.setBillingState(this.value)}),$$("#zip").on("keyup",function(){invoice.setBillingZip(this.value)}),$$("input").each(function(){""!=this.value&&$$(this).attr("placeholder","")})}),myApp.onPageInit("pos_delivery",function(e){function i(){$$("#streetOne-delivery").val(invoice.customer.billing.street),$$("#streetTwo-delivery").val(invoice.customer.billing.streetTwo),$$("#city-delivery").val(invoice.customer.billing.city),$$("#state-delivery").val(invoice.customer.billing.state),$$("#zip-delivery").val(invoice.customer.billing.zip),o()}function t(){$$("#streetOne-delivery").val(invoice.customer.shipping.street),$$("#streetTwo-delivery").val(invoice.customer.shipping.streetTwo),$$("#city-delivery").val(invoice.customer.shipping.city),$$("#state-delivery").val(invoice.customer.shipping.state),$$("#zip-delivery").val(invoice.customer.shipping.zip),o()}function o(){var e=$$("#streetOne-delivery").val(),i=$$("#city-delivery").val(),t=$$("#state-delivery").val(),o=$$("#zip-delivery").val()
""!=e&&""!=i&&""!=t&&o.length>4&&"team"==invoice.delivery.method?(TM.zipdeliverycost(e,i,t,o,function(e){invoice.setDeliveryCost(e.costOfDelivery),invoice.setTaxPercent(e.totaltaxpercent),cartDetailsToolbarHeader()}),TM.deliverystatus(0,"2017",o,a),$$("#section-three").show()):o.length>4&&"shipping"==invoice.delivery.method||(invoice.setDeliveryCost(0),invoice.setDeliveryDateString("00","00","00"),cartDetailsToolbarHeader(),$$("#section-three").hide())}function n(){NativeStorage.getItem("sameBilling",function(e){"team"!=invoice.delivery.method&&"shipping"!=invoice.delivery.method||(e?(consool("set from billing"),i()):(consool("set from saved"),t())),$$("#same-as-billing").prop("checked",e)},consool)}function a(e){for(var i=e.dates,t=0;t<i.length;t++){var o=i[t].dateYear,n=i[t].dateMonth-1,a=i[t].dateDay,c=$$('.picker-calendar-day[data-year="'+o+'"][data-month="'+n+'"][data-day="'+a+'"]')
c.css("background-color",i[t].colorName).css("color","white"),c.data("status",i[t].colorName)}}switch(n(),$$("#delivery-method").val(invoice.delivery.method),$$("#additional-notes").val(invoice.delivery.notes),invoice.delivery.method){case"team":$$("#method-title").text("Delivery (WA Only)")
break
case"shipping":$$("#method-title").text("Shipping")
break
case"carryout":$$("#method-title").text("Carryout"),$$("#section-two").hide(),$$("#section-three").hide(),$$("#section-five").show()
break
case"pickup":$$("#method-title").text("Pick Up"),$$("#section-two").hide(),$$("#section-three").hide(),$$("#section-four").show()
break
case"later":$$("#method-title").text("Decide Later"),$$("#section-two").hide(),$$("#section-three").hide(),$$("#section-five").show()}switch(invoice.delivery.location){case"I":$$("#pickup-location-id").text("Seattle Store")
break
case"W":$$("#pickup-location-id").text("Warehouse")
break
default:consool("broke"),consool(invoice.delivery.location)}$$("#delivery-method").on("change",function(){var e=this.value
switch(invoice.resetDeliveryInfo(),e){case"team":invoice.setDeliveryMethod("team"),n(),$$("#section-two").show(),$$("#section-four").hide(),o()
break
case"shipping":invoice.setDeliveryMethod("shipping"),n(),$$("#section-two").show(),$$("#section-three").hide(),$$("#section-four").hide()
break
case"pickup":invoice.setDeliveryMethod("pickup"),$$("#section-two").hide(),$$("#section-three").hide(),$$("#section-four").show(),$$("#section-five").show()
break
case"carryout":invoice.setDeliveryMethod("carryout"),$$("#section-two").hide(),$$("#section-three").hide(),$$("#section-four").hide(),$$("#section-five").show()
break
case"later":invoice.setDeliveryMethod("later"),$$("#section-two").hide(),$$("#section-three").hide(),$$("#section-four").hide(),$$("#section-five").show()}}),$$("#pickup-location").on("change",function(){var e=this.value
invoice.setDeliveryLocation(e)}),$$(".delivery-input").on("keyup",o),$$("#streetOne-delivery").on("keyup",function(){$$("#same-as-billing").prop("checked")?invoice.setBillingStreet(this.value):invoice.setShippingStreet(this.value)}),$$("#streetTwo-delivery").on("keyup",function(){$$("#same-as-billing").prop("checked")?invoice.setBillingStreetTwo(this.value):invoice.setShippingStreetTwo(this.value)}),$$("#city-delivery").on("keyup",function(){$$("#same-as-billing").prop("checked")?invoice.setBillingCity(this.value):invoice.setShippingCity(this.value)}),$$("#state-delivery").on("keyup",function(){$$("#same-as-billing").prop("checked")?invoice.setBillingState(this.value):invoice.setShippingState(this.value)}),$$("#zip-delivery").on("keyup",function(){$$("#same-as-billing").prop("checked")?invoice.setBillingZip(this.value):invoice.setShippingZip(this.value)}),$$("#same-as-billing").on("change",function(){var e=this.checked
NativeStorage.setItem("sameBilling",e,noop,noop),e?i():t()}),$$("#additional-notes").on("keyup",function(){invoice.setDeliveryNotes(this.value)})
var c=["January","February","March","April","May","June","July","August","September","October","November","December"],s=myApp.calendar({container:"#delivery-calendar",value:[new Date],weekHeader:!0,firstDay:0,minDate:new Date,dateFormat:"yy-m-d",toolbarTemplate:'<div class="toolbar calendar-custom-toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link icon-only"><i class="icon icon-back"></i></a></div><div class="center"></div><div class="right"><a href="#" class="link icon-only"><i class="icon icon-forward"></i></a></div></div></div>',onOpen:function(e){if($$(".calendar-custom-toolbar .center").text(c[e.currentMonth]+", "+e.currentYear),$$(".calendar-custom-toolbar .left .link").on("click",function(){s.prevMonth()}),$$(".calendar-custom-toolbar .right .link").on("click",function(){s.nextMonth()}),"00/00/00"!=invoice.getDeliveryDateString()){var i=($$(".picker-calendar-day-selected"),invoice.delivery.year+"-"+(invoice.delivery.month-1)+"-"+invoice.delivery.day)
$$(".picker-calendar-day-selected").removeClass("picker-calendar-day-selected"),$$('.picker-calendar-day[data-date="'+i+'"]').addClass("picker-calendar-day-selected"),$$("#delivery-date").text(" - "+invoice.getDeliveryDateString())}},onMonthYearChangeStart:function(e){NativeStorage.getItem("sameBilling",function(i){i?TM.deliverystatus(parseInt(e.currentMonth)+1,e.currentYear,invoice.customer.billing.zip,a):TM.deliverystatus(parseInt(e.currentMonth)+1,e.currentYear,invoice.customer.shipping.zip,a)},function(e){consool(e)}),$$(".calendar-custom-toolbar .center").text(c[e.currentMonth]+", "+e.currentYear)},onDayClick:function(e,i,t,o,n){o=parseInt(o)+1,$$(i).data("status"),invoice.setDeliveryDateString(o,n,t),$$("#delivery-date").text(" - "+invoice.getDeliveryDateString())}})
myApp.calendar({input:"#pickup-date-input",dateFormat:"DD, MM dd, yyyy",weekHeader:!0,firstDay:0,minDate:new Date,closeOnSelect:!0,onDayClick:function(e,i,t,o,n){invoice.setDeliveryDateString(o,n,t)}})}),myApp.onPageInit("pos_summary",function(e){invoice.setBalance(roundTo(invoice.totalAmount+invoice.delivery.cost,2))
switch($$("#summary-div-billingInfo-name").text(invoice.customer.first+" "+invoice.customer.last),$$("#summary-div-billingInfo-phone").text(""==invoice.customer.phoneNumber?"[None Given]":invoice.customer.phoneNumber),$$("#summary-div-billingInfo-email").text(""==invoice.customer.email?"[None Given]":invoice.customer.email),$$("#summary-div-billingInfo-addr").text(invoice.getBilling()),invoice.delivery.method){case"shipping":case"team":$$("#summary-div-receiving-method").text("team"==invoice.delivery.method?"In-Home Delivery":"Shipping"),$$("#summary-div-receiving-addr").show(),$$("#summary-div-receiving-date").text(invoice.delivery.date),NativeStorage.getItem("sameBilling",function(e){e?$$("#summary-div-receiving-addr").text(invoice.getBilling()):$$("#summary-div-receiving-addr").text(invoice.getShipping())},function(e){})
break
case"pickup":$$("#summary-div-receiving-method").text("Pick Up"),$$("#summary-div-receiving-addr").hide(),$$("#summary-div-receiving-date").text(invoice.delivery.date)
break
case"carryout":case"later":$$("#summary-div-receiving-method").text("N/A"),$$("#summary-div-receiving-addr").hide(),$$("#summary-div-receiving-date").hide()}invoice.draw("#summary-cart"),invoice.salesLines.length<1&&($$("#customer-cart-div").hide(),$$("#cart-title").hide()),$$("#summary-subtotal").text(formatNumberMoney(invoice.subtotalAmount)),$$("#summary-tax").text(formatNumberMoney(invoice.taxAmount)),$$("#summary-delivery").text(formatNumberMoney(invoice.delivery.cost)),$$("#summary-total").text(formatNumberMoney(invoice.totalAmount+invoice.delivery.cost)),$$("#summary-paid").text(formatNumberMoney(invoice.getRemainingBalance())),invoice.payments.length>0&&invoice.drawPayments(invoice.payments,"#customer-cart-div"),invoice.delivery.notes.length>0?$$("#summary-delivery-notes").text(invoice.delivery.notes):$$("#note-card-summary").hide(),$$(".pos-pay").on("click",function(){invoice.totalAmount+invoice.delivery.cost>0&&invoice.paymentPopup()})}),myApp.onPageInit("pos__thankyou",function(e){invoice.employee=EMPLOYEE
var i=e.query.data.invoicenumber
$$("#ty_invoice_number").text(e.query.data.invoicenumber),$$("#email-rec").on("click",function(){myApp.modal({title:"Email Receipt",text:'<input id="email-rec-input">',afterText:"",buttons:[{text:"Cancel",onClick:function(){}},{text:"Send",onClick:function(){TM.emailInvoice($$("#email-rec-input").val(),i,consool)}}]})
$$("#email-rec-input").val(e.query.email)}),$$("#print-rec").on("click",function(){TM.listPrinters(function(e){choicelistModal({type:"modal",data:e.altnames,success:function(t,o,n){TM.printInvoice(i,"invoice",e.names[t],consool)}})})}),$$("#none-rec").on("click",function(){mainView.router.loadPage("profile.html")})}),myApp.onPageInit("clk_home",function(e){function i(e){if(e>0){var i=new Date(1e3*e),t=i.getHours(),o=i.getMinutes(),n=i.getSeconds(),a=!1
t>12&&(a=!0,t-=12),t=t<10?"0"+t:t,o=o<10?"0"+o:o,n=n<10?"0"+n:n
var c=t+":"+o+":"+n
return c+=a?" PM":" AM"}return""}function t(e){if(e>0){var i=new Date(1e3*e)
return i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()}return"Error getting date"}var o=new Date,n=(o.getMonth(),o.getDate(),o.getFullYear(),o.getHours())
n=n>12?n-12:n
var a=o.getMinutes()
a=a<10?"0"+a:a
var c=o.getSeconds()
c=c<10?"0"+c:c,$$(".current-clock-time").text(n+":"+a+":"+c),setInterval(function(){var e=new Date,i=e.getHours()
i=i>12?i-12:i
var t=e.getMinutes()
t=t<10?"0"+t:t
var o=e.getSeconds()
o=o<10?"0"+o:o,$$(".current-clock-time").text(i+":"+t+":"+o)},1e3),TM.timeclock(invoice.id,"STATUS",function(e){var o=""
e.currentlyClockedIn?($$("#clockin-button").addClass("inactive"),$$("#clockout-button").removeClass("inactive")):($$("#clockin-button").removeClass("inactive"),$$("#clockout-button").addClass("inactive")),o+='<div class="list-block-label clockhistory-list-label">'+t(e.timecards[0].clockInUnixTimeStamp)+"</div>"
for(var n=0;n<e.timecards.length;n++)n>0&&e.timecards[n].clockInDate!=e.timecards[n-1].clockInDate&&(o+='<div class="list-block-label clockhistory-list-label">'+t(e.timecards[n].clockInUnixTimeStamp)+"</div>"),o+='<li class="item-content"><div class="item-inner"><div class="row row-fullwidth"><div class="col-50 left-align">'+i(e.timecards[n].clockInUnixTimeStamp)+'</div><div class="col-50 right-align">'+i(e.timecards[n].clockOutUnixTimeStamp)+"</div></div></div></li>"
$$(".clock-history").append(o)}),$$(".clock-button").on("click",function(){if(!$$(this).hasClass("inactive")){var e=$$(this).data("clockevent")
TM.timeclock(EMPLOYEE.id,e,function(i){i.ok&&"start"==e?($$("#clockin-button").addClass("inactive"),$$("#clockout-button").removeClass("inactive"),toast("Clocked In",SHORT)):i.ok&&"stop"==e&&($$("#clockin-button").removeClass("inactive"),$$("#clockout-button").addClass("inactive"),toast("Clocked Out",SHORT))})}})}),myApp.onPageInit("msg_list",function(e){$$("#conversations").on("click",".conversation",function(){var e=$$(this).data("id")
mainView.router.load({url:"msg_msg.html",query:{id:e}})}),TM.getConversations(function(e){for(var i=e.conversations,t="",o=0;o<i.length;o++)t+='<li class="conversation" data-id="'+i[o].id+'"><a href="#" class="item-link item-content"><div class="item-inner"><div class="item-title-row"><div class="item-title">'+i[o].membersString+'</div><div class="item-after">'+(i[o].recentMessages.length>0?i[o].recentMessages[0].timestring:"")+'</div></div><div class="item-subtitle">'+(i[o].newMessageStatusBool?"New Message from "+i[o].recentMessages[0].sendername:"")+'</div><div class="item-text">'+(i[o].recentMessages.length>0?i[o].recentMessages[0].message:"")+"</div></div></a></li>"
$$("#conversations").append(t)}),$$(".compose-new-message").on("click",function(){myApp.popup('<div class="popup payment-popup" id="compose-pop"><div class="popup-header"><h1 style="margin-bottom: 0;">New Message</h1></div><div class="compose-body"></div><div class="compose-message-bar"><textarea id="composed-message" placeholder="Message"></textarea><a id="send-message" href="#" class="link">Send</a></div></div>')})}),myApp.onPageInit("msg_msg",function(e){var i=e.query.id
$$(".messages").empty(),TM.getMessages(i,drawMessages),$$("#send-message").on("click",function(){var e=$$("#composed-message").val()
TM.sendMessage(i,e,function(){var i='<div class="message message-sent"><div class="message-name">'+EMPLOYEE.name+'</div><div class="message-text">'+e+"</div></div>"
$$(".messages").append(i),scrollMessageToBottom(),$$("#composed-message").val("")})})}),myApp.onPageAfterBack("msg_msg",function(e){clearTimeout(timeoutObj)}),myApp.onPageInit("tools",function(e){}),myApp.onPageInit("settings",function(e){function i(e){consool(e)}function t(e){consool(e)}var o=navigator.camera
$$("#change-profile").on("click",function(){var e={quality:90,destinationType:o.DestinationType.FILE_URI,sourceType:o.PictureSourceType.CAMERA,allowEdit:!1,encodingType:o.EncodingType.JPEG,mediaType:o.MediaType.PICTURE,correctOrientation:!0,saveToPhotoAlbum:!0,cameraDirection:o.Direction.FRONT}
consool("options"),navigator.camera.getPicture(i,t,e)}),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){e.root.getFile("newPersistentFile.txt",{create:!0,exclusive:!1},function(e){console.log("fileEntry is file?"+e.isFile.toString()),writeFile(e,null)},function(){consool("creating file error")})},function(){consool("Loading Filesystem Error")})})
