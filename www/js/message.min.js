/*
** Message Functions
*/
function drawMessages(e){$$("#contact").text(e.membersString)
for(var s=e.messages,a=0;a<s.length;a++){var t="Error loading Message - "+s[a].id
0==a?$$(".messages").append('<div class="messages-date">'+s[a].datestring+"<span>"+s[a].timestring+"</span></div>"):s[a].datestring!=s[a-1].datestring&&$$(".messages").append('<div class="messages-date">'+s[a].datestring+"<span>"+s[a].timestring+"</span></div>"),t=s[a].sender==EMPLOYEE.id?'<div class="message message-sent"><div class="message-name">'+s[a].sendername+'</div><div class="message-text">'+s[a].message+"</div></div>":'<div class="message message-with-avatar message-received"><div class="message-name">'+s[a].sendername+'</div><div class="message-text">'+s[a].message+'</div><div style="background-image:url(https://taskmaster.bedroomsandmore.com/4DACTION/getImage/Employees/'+s[a].sender+')" class="message-avatar"></div></div>',$$(".messages").append(t)}scrollMessageToBottom(),startMessageCheck(e.conversationId,s[s.length-1].id)}function startMessageCheck(e,s){timeoutObj=setTimeout(function(){TM.checkNewMessages(e,s,function(a){for(var t=0;t<a.messages.length;t++){var i="Error loading Message - "+a.messages[t].id
i=a.messages[t].sender==EMPLOYEE.id?'<div class="message message-sent '+(t==a.messages.length?"active":"")+'"><div class="message-name">'+a.messages[t].sendername+'</div><div class="message-text">'+a.messages[t].message+"</div></div>":'<div class="message message-with-avatar message-received '+(t==a.messages.length?"active":"")+'"><div class="message-name">'+a.messages[t].sendername+'</div><div class="message-text">'+a.messages[t].message+'</div><div style="background-image:url(http://lorempixel.com/output/people-q-c-100-100-9.jpg)" class="message-avatar"></div></div>',$$(".messages").append(i)}a.messages.length>0?startMessageCheck(e,a.messages[a.messages.length-1].id):startMessageCheck(e,s)})},5e3)}function notificationTimeoutStart(e,s,a,t){var i=""
TM.getNotifications(function(n){var m=n.notifications[0].amount,g=n.notifications[1].amount,o=n.notifications[2].amount,d=n.total
n.total>0&&d>t&&(m>0&&m>e&&(i+=m-e+" new email"+(m-e>1?"s":"")+"; "+m+" total email"+(m>1?"s":"")+".<br>"),g>0&&g>s&&(i+=g-s+" new message"+(g-s>1?"s":"")+"; "+g+" total message"+(g>1?"s":"")+".<br>"),o>0&&o>a&&(i+=o-a+" new voicemail"+(o-a>1?"s":"")+"; "+o+" total voicemail"+(o>1?"s":"")+".<br>"),myApp.addNotification({title:"Notifications",message:i})),setTimeout(function(){t=n.total,notificationTimeoutStart(m,g,o,t)},15e3)})}function scrollMessageToBottom(){var e=$$(".message").filter(function(e){return e===$$(".message").length-1})
$$(".page-content").scrollTop(e[0].offsetTop)}var timeoutObj,newestMessageId
