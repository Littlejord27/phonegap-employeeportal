function Invoice(t){void 0===t?(this.id=0,this.salesperson="",this.title="draft",this.customer={first:"",last:"",email:"",phoneNumber:""},this.customer.billing={city:"",state:"",street:"",streetTwo:"",zip:""},this.customer.shipping={city:"",state:"",street:"",streetTwo:"",zip:""},this.delivery={method:"",cost:0,date:"00/00/00",month:"00",day:"00",year:"00",location:"",notes:""},this.payments=[],this.salesLines=[],this.discounts=[],this.subtotalAmount=0,this.taxPercent=.101,this.taxAmount=0,this.totalAmount=0,this.balance=0,this.discount=0,this.taxFree=!1):(this.id=t.id,this.salesperson=t.salesperson,this.title=t.title,NativeStorage.setItem("title",t.customer.first,nsSetNoop,noop),this.customer=t.customer,NativeStorage.setItem("first",t.customer.first,nsSetNoop,noop),NativeStorage.setItem("last",t.customer.last,nsSetNoop,noop),NativeStorage.setItem("phoneNumber",t.customer.phoneNumber,nsSetNoop,noop),NativeStorage.setItem("email",t.customer.email,nsSetNoop,noop),this.customer.billing=t.customer.billing,NativeStorage.setItem("streetOne",t.customer.billing.street,nsSetNoop,noop),NativeStorage.setItem("streetTwo",t.customer.billing.streetTwo,nsSetNoop,noop),NativeStorage.setItem("city",t.customer.billing.city,nsSetNoop,noop),NativeStorage.setItem("state",t.customer.billing.state,nsSetNoop,noop),NativeStorage.setItem("zip",t.customer.billing.zip,nsSetNoop,noop),this.customer.shipping=t.customer.shipping,NativeStorage.setItem("streetOne-shipping",t.customer.shipping.street,nsSetNoop,noop),NativeStorage.setItem("streetTwo-shipping",t.customer.shipping.streetTwo,nsSetNoop,noop),NativeStorage.setItem("city-shipping",t.customer.shipping.city,nsSetNoop,noop),NativeStorage.setItem("state-shipping",t.customer.shipping.state,nsSetNoop,noop),NativeStorage.setItem("zip-shipping",t.customer.shipping.zip,nsSetNoop,noop),this.delivery=t.delivery,NativeStorage.setItem("method",t.delivery.method,nsSetNoop,noop),NativeStorage.setItem("cost",t.delivery.cost,nsSetNoop,noop),NativeStorage.setItem("month",t.delivery.month,nsSetNoop,noop),NativeStorage.setItem("day",t.delivery.day,nsSetNoop,noop),NativeStorage.setItem("year",t.delivery.year,nsSetNoop,noop),NativeStorage.setItem("date",t.delivery.date,nsSetNoop,noop),NativeStorage.setItem("notes",t.delivery.notes,nsSetNoop,noop),NativeStorage.setItem("location",t.delivery.location,nsSetNoop,noop),this.taxPercent=t.taxPercent,NativeStorage.setItem("taxPercent",t.taxPercent,nsSetNoop,noop),this.payments=t.payments,NativeStorage.setItem("payments",JSON.stringify(t.payments),nsSetNoop,noop),this.salesLines=t.salesLines,NativeStorage.setItem("cart",JSON.stringify(t.salesLines),nsSetNoop,noop),this.discounts=t.discounts,NativeStorage.setItem("discounts",JSON.stringify(t.payments),nsSetNoop,noop),this.taxFree=!1,NativeStorage.setItem("taxFree",t.taxFree,nsSetNoop,noop),this.recalc())}function createStockTable(t){t.push({locationid:42,invoiceLocationID:42,locationname:"Special Order",locationletter:"SO",available:1e3,onorderavailable:0})
for(var e="<table><tr><th>Location</th><th></th><th></th></tr>",i=0;i<t.length;i++)if(t[i].locationid,t[i].available>0){consool("Before Second")
var o=getLocationNickname(t[i].locationid),n='<tr id="locationLine'+i+'" class="locationLine"><td>'+o+" "+(42==t[i].locationid?'<span class="orange">'+(t[i].onorderavailable>0?"- "+t[i].onorderavailable:"")+"</span>":"- "+t[i].available)+'</td><td><input id="locationLineInput'+i+'" class="stock-table-quantity" type="number" value="0" data-stock="'+t[i].available+'" data-location="'+t[i].locationletter+'"></td><td><div class="row"><div class="col-50 quantity-down"><i class="icon f7-icons">arrow_left_fill</i></div><div class="col-50 quantity-up"><i class="icon f7-icons">arrow_right_fill</i></div></div></td></tr>'
e+=n}else e+='<tr id="locationLine'+i+'" class="locationLine"><td colspan="3" style="text-align: center;">'+t[i].locationname+" - Out Of Stock</td></tr>"
return e+="</table>"}function nsSetNoop(t){}Invoice.prototype.setSalesperson=function(t){this.salesperson=t},Invoice.prototype.setTitle=function(t){this.title=t,NativeStorage.setItem("title",this.customer.first,nsSetNoop,noop)},Invoice.prototype.changeQuantity=function(t,e){this.salesLines[t].quantity=e,NativeStorage.setItem("cart",JSON.stringify(this.salesLines),nsSetNoop,noop),this.recalc()},Invoice.prototype.changeLocation=function(t,e){this.salesLines[t].location
this.salesLines[t].location=e
for(var i=0;i<this.salesLines[t].stock.length;i++)if(this.salesLines[t].stock[i].locationletter==e){var o=this.salesLines[t].stock[i].available
this.salesLines[t].quantity=this.salesLines[t].quantity>o?o:this.salesLines[t].quantity,o<1&&toast("No Stock at Selected Location",LONG),0==this.salesLines[t].quantity&&0!=o&&toast("Please Select a Quantity",LONG)}NativeStorage.setItem("cart",JSON.stringify(this.salesLines),nsSetNoop,noop),this.recalc()},Invoice.prototype.addLine=function(t){this.salesLines.push(t),NativeStorage.setItem("cart",JSON.stringify(this.salesLines),nsSetNoop,noop),this.recalc()},Invoice.prototype.deleteLine=function(t){this.salesLines.splice(t,1),NativeStorage.setItem("cart",JSON.stringify(this.salesLines),nsSetNoop,noop),invoice.setPayments([]),invoice.getRemainingBalance(),this.recalc()},Invoice.prototype.addPayments=function(t){this.payments=this.payments.concat(t),NativeStorage.setItem("payments",JSON.stringify(this.payments),nsSetNoop,noop)},Invoice.prototype.deletePayment=function(t){this.payments.splice(t,1),this.getRemainingBalance(),NativeStorage.setItem("payments",JSON.stringify(this.payments),nsSetNoop,noop)},Invoice.prototype.addDiscount=function(t){for(var e=0;e<this.discounts.length;e++)if(this.discounts[e].type==t.type)return void consool("already in")
this.discounts.push(t),NativeStorage.setItem("discounts",JSON.stringify(this.discounts),nsSetNoop,noop),this.recalc(),cartDetailsToolbarHeader()},Invoice.prototype.recalc=function(t){this.subtotalAmount=0,this.taxAmount=0,this.totalAmount=0,this.discount=0
for(var e=0;e<this.salesLines.length;e++){var i=this.salesLines[e].retailAmount*this.salesLines[e].quantity
this.subtotalAmount+=i,this.taxAmount+=i*this.taxPercent}for(var e=0;e<this.discounts.length;e++)this.discount+=this.calcDiscount(this.discounts[e])
this.subtotalAmount=roundTo(this.subtotalAmount,2),this.taxAmount=roundTo(this.taxAmount,2),this.discount=roundTo(this.discount,2),this.totalAmount=roundTo(this.subtotalAmount-this.discount,2),this.taxFree||(this.totalAmount=roundTo(this.totalAmount+this.taxAmount,2))},Invoice.prototype.setTaxFree=function(t){this.taxFree=t,NativeStorage.setItem("taxFree",this.taxFree,nsSetNoop,noop),this.recalc(),cartDetailsToolbarHeader()},Invoice.prototype.setFirstName=function(t){this.customer.first=t,NativeStorage.setItem("first",this.customer.first,nsSetNoop,noop)},Invoice.prototype.setLastName=function(t){this.customer.last=t,NativeStorage.setItem("last",this.customer.last,nsSetNoop,noop)},Invoice.prototype.setPhoneNumber=function(t){this.customer.phoneNumber=t,NativeStorage.setItem("phoneNumber",this.customer.phoneNumber,nsSetNoop,noop)},Invoice.prototype.setEmail=function(t){this.customer.email=t,NativeStorage.setItem("email",this.customer.email,nsSetNoop,noop)},Invoice.prototype.setBillingStreet=function(t){this.customer.billing.street=t,NativeStorage.setItem("streetOne",this.customer.billing.street,nsSetNoop,noop)},Invoice.prototype.setBillingStreetTwo=function(t){this.customer.billing.streetTwo=t,NativeStorage.setItem("streetTwo",this.customer.billing.streetTwo,nsSetNoop,noop)},Invoice.prototype.setBillingCity=function(t){this.customer.billing.city=t,NativeStorage.setItem("city",this.customer.billing.city,nsSetNoop,noop)},Invoice.prototype.setBillingState=function(t){this.customer.billing.state=t,NativeStorage.setItem("state",this.customer.billing.state,nsSetNoop,noop)},Invoice.prototype.setBillingZip=function(t){this.customer.billing.zip=t,NativeStorage.setItem("zip",this.customer.billing.zip,nsSetNoop,noop)},Invoice.prototype.setShippingStreet=function(t){this.customer.shipping.street=t,NativeStorage.setItem("streetOne-shipping",this.customer.shipping.street,nsSetNoop,noop)},Invoice.prototype.setShippingStreetTwo=function(t){this.customer.shipping.streetTwo=t,NativeStorage.setItem("streetTwo-shipping",this.customer.shipping.streetTwo,nsSetNoop,noop)},Invoice.prototype.setShippingCity=function(t){this.customer.shipping.city=t,NativeStorage.setItem("city-shipping",this.customer.shipping.city,nsSetNoop,noop)},Invoice.prototype.setShippingState=function(t){this.customer.shipping.state=t,NativeStorage.setItem("state-shipping",this.customer.shipping.state,nsSetNoop,noop)},Invoice.prototype.setShippingZip=function(t){this.customer.shipping.zip=t,NativeStorage.setItem("zip-shipping",this.customer.shipping.zip,nsSetNoop,noop)},Invoice.prototype.setDeliveryMethod=function(t){this.delivery.method=t,NativeStorage.setItem("method",this.delivery.method,nsSetNoop,noop)},Invoice.prototype.setDeliveryCost=function(t){this.delivery.cost=t,NativeStorage.setItem("cost",this.delivery.cost,nsSetNoop,noop)},Invoice.prototype.setSalesLines=function(t){this.salesLines=t,NativeStorage.setItem("cart",JSON.stringify(this.salesLines),nsSetNoop,noop),this.recalc()},Invoice.prototype.setPayments=function(t){this.payments=t,NativeStorage.setItem("payments",JSON.stringify(this.payments),nsSetNoop,noop)},Invoice.prototype.setDiscounts=function(t){this.discounts=t,NativeStorage.setItem("discounts",JSON.stringify(this.discounts),nsSetNoop,noop),this.recalc()},Invoice.prototype.setBalance=function(t){for(var e=0;e<this.payments.length;e++)t-=this.payments[e].amount
this.balance=roundTo(t,2)},Invoice.prototype.setDeliveryDateString=function(t,e,i){this.delivery.month=t,this.delivery.day=e,this.delivery.year=i,this.delivery.date=t+"/"+e+"/"+i,NativeStorage.setItem("month",this.delivery.month,nsSetNoop,noop),NativeStorage.setItem("day",this.delivery.day,nsSetNoop,noop),NativeStorage.setItem("year",this.delivery.year,nsSetNoop,noop),NativeStorage.setItem("date",this.delivery.date,nsSetNoop,noop)},Invoice.prototype.setTaxPercent=function(t){this.taxPercent=t,NativeStorage.setItem("taxPercent",this.taxPercent,nsSetNoop,noop),this.recalc()},Invoice.prototype.setDeliveryLocation=function(t){this.delivery.location=t,NativeStorage.setItem("location",this.delivery.location,nsSetNoop,noop)},Invoice.prototype.setDeliveryNotes=function(t){this.delivery.notes=t,NativeStorage.setItem("notes",this.delivery.notes,nsSetNoop,noop)},Invoice.prototype.getDeliveryMethod=function(){return this.delivery.method},Invoice.prototype.getDeliveryCost=function(){return this.delivery.cost},Invoice.prototype.getDeliveryDateString=function(){return this.delivery.date},Invoice.prototype.getTaxPercent=function(){return this.taxPercent},Invoice.prototype.getDeliveryLocation=function(){return this.delivery.location},Invoice.prototype.getDeliveryNotes=function(){return this.delivery.notes},Invoice.prototype.getRemainingBalance=function(){this.balance=this.totalAmount+this.delivery.cost
for(var t=0;t<this.payments.length;t++)this.balance-=this.payments[t].amount
return this.balance=roundTo(this.balance,2),this.balance},Invoice.prototype.getBilling=function(){var t=this.customer.billing.street+", "+this.customer.billing.city+", "+this.customer.billing.state+" "+this.customer.billing.zip
return""==this.customer.billing.street?"":t},Invoice.prototype.getShipping=function(){var t=this.customer.shipping.street+", "+this.customer.shipping.city+", "+this.customer.shipping.state+" "+this.customer.shipping.zip
return""==this.customer.shipping.street?"":t},Invoice.prototype.getSkus=function(){for(var t="",e=0;e<this.salesLines.length;e++)t+=this.salesLines[e].sku+","
return t=t.substring(0,t.length-1)},Invoice.prototype.draw=function(t){if(0==this.salesLines.length){if(void 0===t||".cart-list"==t){$$(".cart-list").empty(),$$(".cart-list").append('<div id="new-sale"><div id="new-sale-header"></div><div id="returning-customer">Returning</div></div>'),$$("#returning-customer").on("click",function(){var t=myApp.modal({title:"Customer Lookup",text:'<input id="search-returning-box">',afterText:'<div class="list-block search-result-div"><ul class="search-results-lookup"></ul></div>',buttons:[{text:"Cancel",onClick:function(){}}]})
$$(t).addClass("search-modal")
var e
$$("#search-returning-box").on("keyup",function(){this.value.length>3&&(clearTimeout(e),function(t){e=setTimeout(function(){TM.searchCustomer(t,function(t){$$(".search-results-lookup").empty()
for(var e=0;e<listNames.length;e++)searchItem.on("click",function(){consool(this)})})},500)}(this.value))})})}}else{for(var e="",i=this.salesLines.length-1;i>=0;i--)e+='<div class="card" data-id="'+i+'"><div class="card-header">'+this.salesLines[i].brand+" "+this.salesLines[i].model+'<span class="'+(this.salesLines[i].minimized?"restore-line":"minimize-line")+' card-header-action-line" data-id="'+i+'"><i class="icon f7-icons">'+(this.salesLines[i].minimized?"up":"down")+'</i></span><span class="delete-line card-header-action-line" data-id="'+i+'"><i class="icon f7-icons">close_round</i></span></div><div class="card-content" '+(this.salesLines[i].minimized?'style="display:none;':"")+'"><div class="card-content-inner"><div class="row"><div class="col-30"><img class="prod-img lightbox-image" src="'+this.salesLines[i].imageurl+'"></div><div class="col-50" style="text-align: center;"><span>'+formatNumberMoney(this.salesLines[i].retailAmount)+" ea.</span><br>"+(""!=this.salesLines[i].size?"<span>"+this.salesLines[i].size+"</span><br>":"")+(""!=this.salesLines[i].color?"<span>"+this.salesLines[i].color+"</span><br>":"")+(""!=this.salesLines[i].material?"<span>"+this.salesLines[i].material+"</span><br>":"")+'<p class="location-edit-card" data-id="'+i+'">'+getLocationNickname(this.salesLines[i].location)+'</p></div><div class="col-20">'+discountAmountLine(this.salesLines[i])+'</div></div></div></div><div class="card-footer"><div class="row" style="width: 100%;"><div class="col-50"><p>'+formatNumberMoney(this.salesLines[i].retailAmount*this.salesLines[i].quantity)+'</p></div><div class="col-50 quantity-col-card right-float right-align" data-id="'+i+'"><p>QTY:'+this.salesLines[i].quantity+"</p></div></div></div></div>",e+=getDiscountHTML(this.salesLines[i])
e+=getInvoiceDiscountHTML(this.salesLines[i])
if("team"==invoice.delivery.method&&"00/00/00"!=invoice.getDeliveryDateString()?e+='<div class="card"><div class="card-content"><div class="card-content-inner">In-House Delivery - '+invoice.getDeliveryDateString()+" - "+formatNumberMoney(invoice.delivery.cost)+"</div></div></div>":"carryout"==invoice.delivery.method?e+='<div class="card"><div class="card-content"><div class="card-content-inner">Carryout</div></div></div>':"pickup"==invoice.delivery.method&&""!=invoice.delivery.store?e+='<div class="card"><div class="card-content"><div class="card-content-inner">Pick Up - '+invoice.delivery.store+"</div></div></div>":"later"==invoice.delivery.method&&(e+='<div class="card"><div class="card-content"><div class="card-content-inner">No Delivery Scheduled</div></div></div>'),this.discounts.length>0){var o=""
e+='<div class="card"><div class="card-content"><div class="card-content-inner">'
for(var i=0;i<this.discounts.length;i++)switch(this.discounts[i].type){case"2SideCred":o+="2-Sided Classics",o+=", "
break
case"45AdjBaseCred":o+="45th Adjustable Credit",o+=", "
break
case"beddingBund":o+="Bedding Bundle",o+=", "
break
case"instockLighting":o+="In-Stock Lighting",o+=", "
break
default:o+=this.discounts[i].type,o+=", "}o=o.substring(0,o.length-2),e+=o,e+="</div></div></div>"}void 0!==t?($$(t).empty(),$$(t).append(e)):($$(".cart-list").empty(),$$(".cart-list").append(e))}},Invoice.prototype.itemPopup=function(t){var e=createStockTable(t.stock)
console.log(e),console.log(t.model),console.log(t.brand),console.log(t.categoryname),console.log(t.size),console.log(t.color),console.log(t.material),console.log(t.imageurl),console.log(formatNumberMoney(t.retailAmount)),console.log(t.sku)
var i='<div class="popup stock-popup"><div class="content-block center-align"><div><h1>'+t.model+"</h1></div><div><h3>"+t.brand+'</h3></div><div><p class="low-vis-black">'+t.categoryname+'</p></div><div class="row attribute-border"><div class="col-33">'+t.size+'</div><div class="col-33">'+t.color+'</div><div class="col-33">'+t.material+'</div></div><div><img src="'+t.imageurl+'"></div><div><p>'+formatNumberMoney(t.retailAmount)+'</p></div><div class="stock-table"><div class="list-block-title left-align">Choose Stock</div></div><div class="row popup-action-button-div"><div class="col-50 popup-action-button close-popup" style="background-color:red;"><p>Close</p></div><div class="col-50 popup-action-button add-to-cart"><p>Add to Cart</p></div></div><div><p class="low-vis-black">'+t.sku+"</p></div></div></div>"
myApp.popup(i),$$(".stock-table").append(e),$$(".add-to-cart").on("click",function(){for(var e=$$(".stock-table-quantity"),i=0;i<e.length;i++)if(e[i].value>0){var o=JSON.parse(JSON.stringify(t))
o.quantity=e[i].value,o.location=$$(e[i]).data("location"),o.minimized=!1,invoice.addLine(o)}invoice.draw(),myApp.closeModal(".stock-popup"),myApp.closeModal(".search-modal"),cartDetailsToolbarHeader()}),$$(".quantity-down").on("click",function(){var t=$$(this.parentElement.parentElement.parentElement),e=(parseInt(t.find("input").data("stock")),parseInt(t.find("input").val()))
e<=0?t.find("input").val(0):t.find("input").val(e-1)}),$$(".quantity-up").on("click",function(){var t=$$(this.parentElement.parentElement.parentElement),e=parseInt(t.find("input").data("stock")),i=parseInt(t.find("input").val())
i>=e?t.find("input").val(e):t.find("input").val(i+1)})},Invoice.prototype.xfactorsModal=function(){myApp.modal({title:"XFactors",text:'<div class="Test">Test</div>',buttons:[{text:"Cancel",onClick:function(){myApp.alert("You clicked Cancel.")}},{text:"Okay",bold:!0,onClick:function(){invoice.paymentPopup(),myApp.alert("You clicked Okay.")}}]})},Invoice.prototype.paymentPopup=function(){var t=this.balance,e=[],i=(new Date).toDateString(),o='<div class="popup payment-popup" id="payment-pop"><div class="popup-header"><h1>Payment Received Today</h1></div><div class="content-block center-align"><div id="date-payment-div">Date:<b>'+i+'</b></div><div id="balance-payment-div">Balance:<b><span id="remaining-balance">'+formatNumberMoney(t)+'</span></b></div><div>Amount:<input id="balance-input" type="number"><span class="payment-type-button" data-type="Full" style="font-size: 30px; font-size: 3.5vw;"><-- Pay in Full</span></div><div class="row"><div class="col-50"><p class="payment-type-button right-float" data-type="Cash">Cash</p></div><div class="col-50"><p class="payment-type-button left-float" data-type="Check">Check</p></div></div><div class="row"><div class="col-50"><p class="payment-type-button right-float" data-type="Charge">Charge</p></div><div class="col-50"><p class="payment-type-button left-float" data-type="Finance">Finance</p></div></div><div class="row"><div class="col-50"><p class="payment-type-button right-float" data-type="Paypal">Paypal</p></div><div class="col-50"><p class="payment-type-button left-float" data-type="InstoreCredit">InstoreCredit</p></div></div><div class="row"><div class="col-50"><p class="payment-type-button right-float" data-type="Stripe4Woocomerce">Stripe4Woocomerce</p></div><div class="col-50"><p class="payment-type-button left-float" data-type="Admin">Admin Write Off</p></div></div><div class="row"><div class="col-50"><p class="payment-type-button right-float" data-type="Gift">Gift Card</p></div><div class="col-50"><p class="payment-type-button left-float" data-type="Multi">Multi</p></div></div><div class="row popup-action-button-div"><div class="col-30 popup-action-button close-popup close-payment-popup" style="background-color:red;"><p>Close</p></div><div class="col-10"></div><div class="col-30 popup-action-button skip-payment"><p>No Payment</p></div><div class="col-30 popup-action-button add-payments"><p>Record</p></div></div></div></div>'
myApp.popup(o),invoice.drawPayments(invoice.payments,"#payment-pop"),$$(".close-payment-popup").on("click",function(){invoice.drawPayments(invoice.payments,"#customer-cart-div")}),$$("#balance-input").on("keyup",function(){this.value>t&&$$("#balance-input").val(t)}),$$(".skip-payment").on("click",function(){invoice.addPayments(e),myApp.closeModal("#payment-pop"),invoice.employee=EMPLOYEE,TM.createInvoice(invoice,function(t){console.log(t),mainView.router.load({url:"pos__thankyou.html",query:{data:t,email:invoice.customer.email}}),invoice.reinit()})}),$$(".payment-type-button").on("click",function(){$$(".skip-payment").text("Down Payment"),$$(".skip-payment").css("padding-top","5px")
var i=$$("#balance-input").val(),o=$$(this).data("type")
if("Full"==o||"Charge"==o||"Finance"==o||i>0&&!isNaN(i)&&"Full"!=o){switch(o){case"Cash":case"Check":e.push({type:o,amount:i})
break
case"Charge":var n=[{text:"Amex",onClick:function(){e.push({type:"Amex",amount:i}),t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val("")}},{text:"Discover",onClick:function(){e.push({type:"Discover",amount:i}),t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val("")}},{text:"Mastercard",onClick:function(){e.push({type:"Mastercard",amount:i}),t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val("")}},{text:"Visa",onClick:function(){e.push({type:"Visa",amount:i}),t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val("")}},{text:"Cancel",color:"red",onClick:function(){}}]
myApp.actions(n)
break
case"Finance":var n=[{text:"Synchrony (GE)",onClick:function(){e.push({type:"Synchrony (GE)",amount:i}),t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val("")}},{text:"ITEX",onClick:function(){e.push({type:"ITEX",amount:i}),t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val("")}},{text:"Cancel",color:"red",onClick:function(){}}]
myApp.actions(n)
break
case"Paypal":case"InstoreCredit":case"Stripe4Woocomerce":case"Admin":case"Gift":case"Multi":e.push({type:o,amount:i})
break
case"Full":$$("#balance-input").val(t)}"Full"!=o&&"Finance"!=o&&"Charge"!=o&&(t=Math.abs(t-i),$$("#remaining-balance").text(formatNumberMoney(t)),invoice.drawPayments(e,"#payment-pop"),$$("#balance-input").val(""))}}),$$(".add-payments").on("click",function(){invoice.addPayments(e),$$("#summary-paid-label").show(),myApp.closeModal("#payment-pop"),invoice.getRemainingBalance()>0?invoice.drawPayments(invoice.payments,"#customer-cart-div"):(invoice.employee=EMPLOYEE,TM.createInvoice(invoice,function(t){console.log(t),mainView.router.load({url:"pos__thankyou.html",query:{data:t,email:invoice.customer.email}}),invoice.reinit()}))})},Invoice.prototype.drawPayments=function(t,e){$$("#payment-popup-div").remove()
for(var i='<div id="payment-popup-div" class="list-block"><ul>',o=t.length-1;o>=0;o--){i+='<li class="item-content"><div class="item-media"><a href="#" class="link icon-only delete-payment" data-id="'+o+'"><i class="icon f7-icons">delete_round</i></a></div><div class="item-inner"><div class="item-title">'+t[o].amount+'</div><div class="item-after">'+t[o].type+"</div></div></li>"}$$(e).append(i+"</ul></div>"),$$("#summary-paid").text(formatNumberMoney(this.getRemainingBalance())),$$(".delete-payment").on("click",function(){var t=$$(this),i=t.data("id")
invoice.deletePayment(i),invoice.drawPayments(invoice.payments,e)})},Invoice.prototype.isTaxFreeDiscountActive=function(){for(var t=0;t<this.discounts.length;t++)if("Tax"==this.discounts[t].type)return!0
return!1},Invoice.prototype.resetCustomerInfo=function(){this.setFirstName(""),this.setLastName(""),this.setPhoneNumber(""),this.setEmail("")},Invoice.prototype.resetBillingInfo=function(){this.setBillingStreet(""),this.setBillingStreetTwo(""),this.setBillingCity(""),this.setBillingState(""),this.setBillingZip("")},Invoice.prototype.resetShippingInfo=function(){this.setShippingStreet(""),this.setShippingStreetTwo(""),this.setShippingCity(""),this.setShippingState(""),this.setShippingZip("")},Invoice.prototype.resetDeliveryInfo=function(){this.setDeliveryMethod("team"),this.setDeliveryCost(0),this.setDeliveryDateString("00","00","00"),this.setTaxPercent(.101),this.setDeliveryNotes(""),this.recalc()},Invoice.prototype.reinit=function(){NativeStorage.clear(consool,consool),this.resetCustomerInfo(),this.resetBillingInfo(),this.resetShippingInfo(),this.resetDeliveryInfo(),this.salesLines=[],this.payments=[],this.setBalance(0),this.setDiscounts([]),this.recalc(),mainView.router.refreshPage()},Invoice.prototype.load=function(){NativeStorage.getItem("title",function(t){invoice.setTitle(t)},function(t){2==t.code?invoice.setTitle("draft"):consool(t)}),NativeStorage.getItem("first",function(t){invoice.setFirstName(t)},function(t){2==t.code?invoice.setFirstName(""):consool(t)}),NativeStorage.getItem("last",function(t){invoice.setLastName(t)},function(t){2==t.code&&invoice.setLastName("")}),NativeStorage.getItem("phoneNumber",function(t){invoice.setPhoneNumber(t)},function(t){2==t.code&&invoice.setPhoneNumber("")}),NativeStorage.getItem("email",function(t){invoice.setEmail(t)},function(t){2==t.code&&invoice.setEmail("")}),NativeStorage.getItem("streetOne",function(t){invoice.setBillingStreet(t)},function(t){2==t.code&&invoice.setBillingStreet("")}),NativeStorage.getItem("streetTwo",function(t){invoice.setBillingStreetTwo(t)},function(t){2==t.code&&invoice.setBillingStreetTwo("")}),NativeStorage.getItem("city",function(t){invoice.setBillingCity(t)},function(t){2==t.code&&invoice.setBillingCity("")}),NativeStorage.getItem("state",function(t){invoice.setBillingState(t)},function(t){2==t.code&&invoice.setBillingState("")}),NativeStorage.getItem("zip",function(t){invoice.setBillingZip(t)},function(t){2==t.code&&invoice.setBillingZip("")}),NativeStorage.getItem("streetOne-shipping",function(t){invoice.setShippingStreet(t)},function(t){2==t.code?invoice.setShippingStreet(""):consool(t)}),NativeStorage.getItem("streetTwo-shipping",function(t){invoice.setShippingStreetTwo(t)},function(t){2==t.code?invoice.setShippingStreetTwo(""):consool(t)}),NativeStorage.getItem("city-shipping",function(t){invoice.setShippingCity(t)},function(t){2==t.code?invoice.setShippingCity(""):consool(t)}),NativeStorage.getItem("state-shipping",function(t){invoice.setShippingState(t)},function(t){2==t.code?invoice.setShippingState(""):consool(t)}),NativeStorage.getItem("zip-shipping",function(t){invoice.setShippingZip(t)},function(t){2==t.code?invoice.setShippingZip(""):consool(t)}),NativeStorage.getItem("method",function(t){invoice.setDeliveryMethod(t)},function(t){2==t.code?invoice.setDeliveryMethod(""):consool(t)}),NativeStorage.getItem("cost",function(t){invoice.setDeliveryCost(t)},function(t){2==t.code?invoice.setDeliveryCost(0):consool(t)}),NativeStorage.getItem("date",function(t){invoice.delivery.date=t},function(t){2==t.code?invoice.delivery.date="00/00/00":consool(t)}),NativeStorage.getItem("month",function(t){invoice.delivery.month=t},function(t){2==t.code?invoice.delivery.month="00":consool(t)}),NativeStorage.getItem("day",function(t){invoice.delivery.day=t},function(t){2==t.code?invoice.delivery.day="00":consool(t)}),NativeStorage.getItem("year",function(t){invoice.delivery.year=t},function(t){2==t.code?invoice.delivery.year="00":consool(t)}),NativeStorage.getItem("location",function(t){invoice.delivery.location=t},function(t){2==t.code?invoice.delivery.location="":consool(t)}),NativeStorage.getItem("notes",function(t){invoice.delivery.notes=t},function(t){2==t.code?invoice.delivery.notes="":consool(t)}),NativeStorage.getItem("cart",function(t){invoice.setSalesLines(JSON.parse(t))},function(t){2==t.code?invoice.setSalesLines([]):consool(t)}),NativeStorage.getItem("payments",function(t){invoice.setPayments(JSON.parse(t))},function(t){2==t.code?invoice.setPayments([]):consool(t)}),NativeStorage.getItem("discounts",function(t){invoice.setDiscounts(JSON.parse(t))},function(t){2==t.code?invoice.setDiscounts([]):consool(t)}),NativeStorage.getItem("taxFree",function(t){invoice.setTaxFree(t)},function(t){2==t.code?invoice.setTaxFree(!1):consool(t)})}
